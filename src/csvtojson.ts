import {runStrategy} from './multilinear.js'

interface OHLC {
    open: number;
    high: number;
    low: number;
    close: number;
}

function parseOHLCData(rawData: string): OHLC[] {
    // Split the data into lines
    const lines = rawData.trim().split('\n');

    // The first line is the header (which we ignore)
    // We process all lines starting from the second one (index 1)
    const dataLines = lines.slice(1);

    // Map the indices of the required columns (starting index 0)
    // "Date" (0), "series" (1), "OPEN" (2), "HIGH" (3), "LOW" (4), "PREV. CLOSE" (5), 
    // "ltp" (6), "close" (7), ...
    const OPEN_INDEX = 2;
    const HIGH_INDEX = 3;
    const LOW_INDEX = 4;
    const CLOSE_INDEX = 7;

    return dataLines.map(line => {
        // 1. Split the line by the delimiter (",")
        // 2. Remove the surrounding double quotes (") from each field
        //    (The regex /\"/g replaces all double quotes with an empty string)
        const fields = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(field => field.replace(/"/g, '').trim());

        // 3. Extract the required fields and convert them to numbers
        return {
            open: parseFloat(fields[OPEN_INDEX]),
            high: parseFloat(fields[HIGH_INDEX]),
            low: parseFloat(fields[LOW_INDEX]),
            close: parseFloat(fields[CLOSE_INDEX]),
        };
    });
}

// ----------------------------------------------------
// Your raw data input
const rawData =
`"Date ","series ","OPEN ","HIGH ","LOW ","PREV. CLOSE ","ltp ","close ","vwap ","52W H ","52W L ","VOLUME ","VALUE ","No of trades "
"23-Oct-2025","EQ","118.20","120.20","117.71","117.67","117.85","118.22","119.17","120.20","85.46","3,13,20,313","3,73,24,92,121.50","96,363"
"21-Oct-2025","EQ","118.25","118.90","117.30","118.10","117.46","117.67","118.06","119.16","85.46","47,60,898","56,20,83,062.40","35,886"
"20-Oct-2025","EQ","114.30","119.16","114.25","113.70","118.34","118.10","117.69","119.16","85.46","3,91,31,377","4,60,54,88,203.65","1,24,252"
"17-Oct-2025","EQ","116.15","116.73","112.75","116.11","113.90","113.70","114.65","117.85","85.46","1,67,44,153","1,91,96,80,570.18","67,641"
"16-Oct-2025","EQ","116.65","117.84","115.97","116.40","116.13","116.11","117.00","117.85","85.46","1,51,88,935","1,77,71,65,658.01","53,494"
"15-Oct-2025","EQ","115.50","117.17","115.40","115.27","116.51","116.40","116.51","117.85","85.46","1,05,98,247","1,23,47,95,491.91","49,082"
"14-Oct-2025","EQ","116.96","117.34","114.91","116.95","115.21","115.27","115.89","117.85","85.46","1,08,82,007","1,26,11,09,898.31","49,027"
"13-Oct-2025","EQ","116.87","117.60","116.10","117.24","116.95","116.95","116.87","117.85","85.46","1,18,09,783","1,38,02,03,493.10","53,283"
"10-Oct-2025","EQ","114.50","117.85","114.16","114.30","116.92","117.24","116.79","117.85","85.46","4,08,46,119","4,77,04,94,611.85","1,28,087"
"09-Oct-2025","EQ","113.14","114.80","113.05","113.14","114.23","114.30","114.08","115.71","85.46","1,25,87,389","1,43,59,76,723.81","53,748"
"08-Oct-2025","EQ","114.18","114.48","112.02","114.17","113.15","113.14","113.22","115.71","85.46","1,47,87,767","1,67,42,18,317.10","78,287"
"07-Oct-2025","EQ","114.54","115.10","113.75","114.54","114.17","114.17","114.45","115.71","85.46","1,16,63,822","1,33,49,58,227.87","50,288"
"06-Oct-2025","EQ","114.80","115.60","113.63","114.37","114.38","114.54","114.48","115.71","85.46","1,80,71,031","2,06,88,46,099.06","67,486"
"03-Oct-2025","EQ","112.65","114.85","112.44","112.55","114.30","114.37","113.89","115.71","85.46","2,38,83,726","2,72,01,26,619.31","89,426"
"01-Oct-2025","EQ","112.70","113.56","111.20","112.83","112.65","112.55","112.41","115.71","85.46","1,95,65,179","2,19,92,77,695.11","63,980"
"30-Sep-2025","EQ","110.04","113.70","109.85","109.51","113.10","112.83","112.44","115.71","85.46","3,70,86,442","4,16,99,24,154.01","1,00,781"
"29-Sep-2025","EQ","107.90","110.23","107.90","107.79","109.90","109.51","109.43","115.71","85.46","1,62,44,160","1,77,75,89,373.35","74,083"
"26-Sep-2025","EQ","111.11","111.34","107.30","111.40","107.90","107.79","108.60","115.71","85.46","1,83,77,053","1,99,56,77,707.25","77,017"
"25-Sep-2025","EQ","111.02","112.25","110.42","111.01","111.15","111.40","111.56","115.71","85.46","1,45,83,301","1,62,68,90,604.18","70,395"
"24-Sep-2025","EQ","114.20","114.49","110.61","113.43","110.98","111.01","112.68","115.71","85.46","1,68,17,280","1,89,50,47,037.76","83,787"`;

export function transform() {
    const ohlcArray = parseOHLCData(rawData);
    runStrategy(ohlcArray);
//    console.log(JSON.stringify(ohlcArray, null, 2));
}