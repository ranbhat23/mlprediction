import {simpleRunStrategy} from './simplelinear.js'

interface OHLC {
    open: number;
    high: number;
    low: number;
    close: number;
}

function parseOHLCData(rawData: string): OHLC[] {
    // Split the data into lines
    const lines = rawData.trim().split('\n');

    // The first line is the header (which we ignore)
    // We process all lines starting from the second one (index 1)
    const dataLines = lines.slice(1);

    // Map the indices of the required columns (starting index 0)
    // "Date" (0), "series" (1), "OPEN" (2), "HIGH" (3), "LOW" (4), "PREV. CLOSE" (5), 
    // "ltp" (6), "close" (7), ...
    const OPEN_INDEX = 2;
    const HIGH_INDEX = 3;
    const LOW_INDEX = 4;
    const CLOSE_INDEX = 7;

    return dataLines.map(line => {
        // 1. Split the line by the delimiter (",")
        // 2. Remove the surrounding double quotes (") from each field
        //    (The regex /\"/g replaces all double quotes with an empty string)
        const fields = line.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/).map(field => field.replace(/"/g, '').trim());

        // 3. Extract the required fields and convert them to numbers
        return {
            open: parseFloat(fields[OPEN_INDEX]),
            high: parseFloat(fields[HIGH_INDEX]),
            low: parseFloat(fields[LOW_INDEX]),
            close: parseFloat(fields[CLOSE_INDEX]),
        };
    });
}

// ----------------------------------------------------
// Your raw data input
const rawData =
`"Date ","series ","OPEN ","HIGH ","LOW ","PREV. CLOSE ","ltp ","close ","vwap ","52W H ","52W L ","VOLUME ","VALUE ","No of trades "
"17-Oct-2025","EQ","3,635.00","3,715.00","3,633.00","3,640.30","3,670.00","3,674.80","3,687.22","3,740.00","2,925.00","11,23,500","4,14,25,93,242.70","79,482"
"16-Oct-2025","EQ","3,549.00","3,652.00","3,540.00","3,549.00","3,636.00","3,640.30","3,630.09","3,740.00","2,925.00","15,28,118","5,54,72,03,279.40","1,08,363"
"15-Oct-2025","EQ","3,532.90","3,561.90","3,511.00","3,537.40","3,543.20","3,549.00","3,542.64","3,740.00","2,925.00","10,05,045","3,56,05,11,918.00","62,931"
"14-Oct-2025","EQ","3,533.00","3,549.40","3,506.50","3,533.60","3,528.00","3,537.40","3,524.68","3,740.00","2,925.00","9,25,998","3,26,38,44,837.60","73,194"
"13-Oct-2025","EQ","3,518.00","3,545.00","3,509.50","3,531.90","3,532.90","3,533.60","3,529.62","3,740.00","2,925.00","6,06,122","2,13,93,82,956.40","50,849"
"10-Oct-2025","EQ","3,548.90","3,571.70","3,523.30","3,550.60","3,529.00","3,531.90","3,549.47","3,748.00","2,925.00","8,25,274","2,92,92,82,600.10","60,797"
"09-Oct-2025","EQ","3,559.80","3,561.70","3,526.40","3,565.60","3,544.00","3,550.60","3,545.87","3,748.00","2,925.00","5,97,739","2,11,95,05,760.80","73,798"
"08-Oct-2025","EQ","3,474.00","3,580.00","3,460.00","3,418.20","3,565.00","3,565.60","3,554.91","3,748.00","2,925.00","45,31,362","16,10,85,98,088.70","2,09,805"
"07-Oct-2025","EQ","3,425.00","3,445.90","3,411.00","3,425.40","3,419.00","3,418.20","3,431.85","3,748.00","2,925.00","9,96,165","3,41,86,84,038.40","58,141"
"06-Oct-2025","EQ","3,453.30","3,459.30","3,401.00","3,453.30","3,425.00","3,425.40","3,422.84","3,748.00","2,925.00","11,84,781","4,05,53,20,446.50","79,862"
"03-Oct-2025","EQ","3,379.90","3,459.00","3,378.00","3,408.30","3,450.00","3,453.30","3,418.12","3,863.55","2,925.00","16,55,328","5,65,81,03,027.70","77,070"
"01-Oct-2025","EQ","3,370.00","3,414.90","3,351.00","3,367.00","3,404.80","3,408.30","3,384.57","3,863.55","2,925.00","7,98,754","2,70,34,35,345.20","77,101"
"30-Sep-2025","EQ","3,452.00","3,474.50","3,355.00","3,401.20","3,372.90","3,367.00","3,399.11","3,863.55","2,925.00","17,33,728","5,89,31,38,448.10","1,10,770"
"29-Sep-2025","EQ","3,327.00","3,418.00","3,327.00","3,327.30","3,417.00","3,401.20","3,382.02","3,863.55","2,925.00","14,52,636","4,91,28,38,813.80","1,03,274"
"26-Sep-2025","EQ","3,387.70","3,402.00","3,303.10","3,378.50","3,333.00","3,327.30","3,335.36","3,867.00","2,925.00","75,24,068","25,09,54,67,512.40","87,123"
"25-Sep-2025","EQ","3,408.00","3,419.90","3,370.00","3,418.30","3,388.70","3,378.50","3,382.41","3,867.00","2,925.00","11,39,904","3,85,56,25,215.70","88,587"
"24-Sep-2025","EQ","3,430.00","3,437.40","3,411.00","3,439.20","3,411.00","3,418.30","3,422.39","3,867.00","2,925.00","6,90,454","2,36,30,01,895.50","50,758"`;

export function transform() {
    const ohlcArray = parseOHLCData(rawData);
    simpleRunStrategy(ohlcArray);
//    console.log(JSON.stringify(ohlcArray, null, 2));
}